# shell 编程

## 执行方式

- 头部注释 #!/bin/bash 代表用 bash 解析这个脚本
- sh ./xx.sh
- bash ./xxx.sh 会产生新的子进程 比如脚本里面有 cd /home 执行完 在当前终端不会进入/home
- ./xxx.sh 会产生新的子进程
- source ./xx.sh 在当前进程 比如脚本里面有 cd /home 执行完 当前终端就在/home
- . xx.sh 在当前进程 ( . 其实是 source 简写)

## 管道

- 多个程序连接在一起，把前面输出作为第二个命令的输入 比如 ls -l | more
- 管道符 |
- ps -ef | grep node

## 重定向

- 输入重定向符号 "<"
- 输出重定向符号 ">" ">>" "2>" "&>"

## 变量

- a=123 不能有空格
- let 变量
- l=ls
- ls=$(ls -l) 将命令结果赋值给变量使用$() 或者 ``
- a=" 1 2 " 想要空格就用 "" 表示字符串

变量引用

- 作用范围只针对当前 shell 范围
- echo ${变量名}
- 部分情况可以这样 echo $变量名
- source xx.sh 因为 source 是当前进程执行，所以可以使用变量
- 想要子进程访问父进程变量名，export a=123
- 删除变量 unset a

- 环境变量 env 命令
- echo $USER
- $? 显示上一条命令是否执行成功 0 或者 1 0 表示正常 非 0 不正常
- $$ 是当前进程的 pid
- $0 当前这个进程命令名称
- a=${2-_} 如果$2 为空则 a 的值为 _

环境变量配置文件

- /etc/profile
- /etc/profile.d
- ~/.bash_profile
- ~/.bashrc
- /etc/bashrc

## 数组

- arr=( 1 2 3 )
- 显示数组所有元素 echo {arr[@]}
- 显示数组个数 echo {#arr[@]}
- 显示数组第一个元素 echo {arr[0]}

## 运算符

- \+ \- \* \*\* % /
- expr
- a=\`expr 1 + 2\` 只支持整数 要有空格
- (( a = 10))
- ((a++))
- echo $((10+20))

## 测试

- test 命令
- test 1 = 1
- [ 1 != 1 ] 有方括号可以省略 test 注意变量要加上双引号
- [[2 > 1]] 数字比较要两个括号 注意 10或者以上的就不能用 > < 这种 要用 -gt这种
- echo $? 0 为真 1 为假

## 条件语句 if-then else

```bash
if [[ 2 > 1 ]]
then ls -l
fi
```

- if [[2 > 1]]或命令返回值是否为 0
- then 执行命令
- fi 结束

- if then else

```bash
if [[ 2 > 1 ]]
then ls -l
else ll
fi
```

- if then elif then else

```bash
if [[ 2 > 1 ]]
then ls -l
elif [[ 3 > 1 ]]
then ll
else ll
fi
```

## case 和 select

```bash
case $1 in
条件1)
ll
;;
条件1)
ls
;;
esac
```

## 循环

### for

```bash
for i in {1..9}
do
echo hello
echo $i
done

# c语言风格

for ((i=0;i<10;i++))
do
echo $1
done
```

### while 如果条件为真一直执行

```bash
i=0
while [[ $i < 10 ]]
do
((i++))
done
```

### until 如果条件为假一直执行

```bash
i=0
while [[$i>10]]
do
((i++))
done
```

break 跳出整个循环  
continue 跳出当前继续执行下一个

## 命令行参数

- $0 代表脚本名称
- $1 代表第一个参数
- $* 和 $@ 代表所有位置参数
- $# 代表位置参数数量